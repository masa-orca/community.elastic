---
  - name: Check that you can connect (GET) to a page and it returns a status 200
    ansible.builtin.uri:
      url: http://localhost:9200/
    register: elasticsearch_info

  - name: Set elasticsearch_version_number variable
    ansible.builtin.set_fact:
      elasticsearch_version_number: "{{ elasticsearch_info.json.version.number }}"

  - import_tasks: 1-test-no-auth.yml

  - name: Run handlers to remove previous es instances
    meta: flush_handlers

  - name: Set docker-compose file
    set_fact:
      docker_compose_file: 3-node-with-kibana-no-auth.yml

  - import_role:
      name: setup_elastic

  - import_tasks: 2-test-3-node-with-kibana-no-auth.yml

  - name: Run handlers to remove previous es instances
    meta: flush_handlers

  - name: Set docker-compose file
    set_fact:
      docker_compose_file: single-node-elastic-with-auth.yml

  - import_role:
      name: setup_elastic

  - import_tasks: 3-test-with-auth.yml

  # TODO
  #- name: Run handlers to remove previous es instances
  #  meta: flush_handlers
  #- name: Set docker-compose file
  #  set_fact:
  #    docker_compose_file: 3-node-with-kibana-with-auth.yml

  #- import_role:
  #    name: setup_elastic

  #- import_tasks: 4-test-3-node-with-kibana-with-auth.yml
